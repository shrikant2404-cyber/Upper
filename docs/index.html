<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Uptime Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background:#f7f7f7; }
    h1 { text-align:center; margin-bottom: 40px; }
    canvas { margin: 40px auto; display:block; background:#fff; border:1px solid #ccc; padding:10px; }
  </style>
</head>
<body>
  <h1>Uptime & Response Time Dashboard</h1>

  <div id="charts"></div>

  <script>
    fetch('data.csv')
      .then(r => r.text())
      .then(csvText => {
        const lines = csvText.trim().split('\n');
        const headers = lines.shift().split(',');

        const dataBySite = {};

        lines.forEach(line => {
          const [timestamp, site, uptime, responseTime] = line.split(',');
          if (!dataBySite[site]) dataBySite[site] = { timestamps: [], uptime: [], responseTime: [] };
          dataBySite[site].timestamps.push(timestamp);
          dataBySite[site].uptime.push(+uptime);
          dataBySite[site].responseTime.push(+responseTime);
        });

        const chartsDiv = document.getElementById('charts');

        Object.keys(dataBySite).forEach(site => {
          const container = document.createElement('div');
          container.innerHTML = `<h2>${site}</h2>
            <canvas id="${site}-uptime"></canvas>
            <canvas id="${site}-response"></canvas>`;
          chartsDiv.appendChild(container);

          const siteData = dataBySite[site];

          // Uptime chart (bar)
          new Chart(document.getElementById(`${site}-uptime`), {
            type: 'bar',
            data: {
              labels: siteData.timestamps,
              datasets: [{
                label: 'Uptime',
                data: siteData.uptime,
                backgroundColor: siteData.uptime.map(u => u ? 'green' : 'red')
              }]
            },
            options: {
              responsive:true,
              scales: { y: { beginAtZero:true, max:1 } }
            }
          });

          // Response time chart (line)
          new Chart(document.getElementById(`${site}-response`), {
            type: 'line',
            data: {
              labels: siteData.timestamps,
              datasets: [{
                label: 'Response Time (ms)',
                data: siteData.responseTime,
                borderColor: 'blue',
                fill: false
              }]
            },
            options: { responsive:true, scales:{y:{beginAtZero:true}} }
          });
        });
      });
  </script>
</body>
</html>
